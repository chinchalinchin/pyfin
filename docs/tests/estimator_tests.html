<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>scrilla.tests.estimator_tests API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>scrilla.tests.estimator_tests</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import sys, os
import numpy

PROJECT_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.append(PROJECT_DIR)

from scrilla import settings, services, static
from scrilla.util import outputter, helper, dater
import scrilla.analysis.estimators as estimators
import scrilla.analysis.models.geometric.statistics as statistics

rolling_x_y_1 = [[1, 3, 5, 2, 6, 10],[4, 5, 3, 6, 2, 8]]
rolling_x_y_2 = [[3, 5, 2, 6, 10, 8], [5, 3, 6, 2, 8, 5]]
rolling_x_y_3 = [[5, 2, 6, 10, 8, 2], [3, 6, 2, 8, 5, 10]]
rolling_x_y_4 = [[2, 6, 10, 8, 2, 3], [6, 2, 8, 5, 10, 9]]
x_y_data = [[1, 2, 3, 4, 5, 6, 7],[20, 19, 23, 20, 26, 22, 30]]
x_y_correl, x_y_beta, x_y_alpha = 0.764852927, 1.39286, 17.28571
test_dates = [&#34;2021-03-29&#34;, &#34;2020-10-20&#34;, &#34;2019-12-10&#34;]
test_tickers = [&#34;ALLY&#34;, &#34;BX&#34;]
lots = [ 12, 32, 34, 11, 23, 44, 53, 25, 24, 31, 35, 36]

def percentile_test():
    print(&#39;data : &#39;,x_y_data[1])
    twenty_fifth = estimators.sample_percentile(data=x_y_data[1], percentile=0.25)
    fiftieth = estimators.sample_percentile(data=x_y_data[1], percentile=0.5)
    seventy_fifth = estimators.sample_percentile(data=x_y_data[1], percentile=0.75)
    ninetieth = estimators.sample_percentile(data=x_y_data[1], percentile=0.90)

    outputter.print_line()
    outputter.scalar_result(calculation=&#39;25th percentile&#39;, result = twenty_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;50th percentile&#39;, result = fiftieth, currency=False)
    outputter.scalar_result(calculation=&#39;75th percentile&#39;, result = seventy_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;90th percentile&#39;, result = ninetieth, currency=False)
    outputter.print_line()

    print(&#39;data : &#39;, lots)
    twenty_fifth = estimators.sample_percentile(data=lots, percentile=0.25)
    fiftieth = estimators.sample_percentile(data=lots, percentile=0.5)
    seventy_fifth = estimators.sample_percentile(data=lots, percentile=0.75)
    ninetieth = estimators.sample_percentile(data=lots, percentile=0.90)

    outputter.print_line()
    outputter.scalar_result(calculation=&#39;25th percentile&#39;, result = twenty_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;50th percentile&#39;, result = fiftieth, currency=False)
    outputter.scalar_result(calculation=&#39;75th percentile&#39;, result = seventy_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;90th percentile&#39;, result = ninetieth, currency=False)
    outputter.print_line()


def simple_regression_test():
    # REGRESSION CALCULATIONS
    correl = estimators.sample_correlation(x=x_y_data[0], y=x_y_data[1])
    beta = estimators.simple_regression_beta(x=x_y_data[0],y=x_y_data[1])
    alpha = estimators.simple_regression_alpha(x=x_y_data[0],y=x_y_data[1])
    
    # TEST RESULTS
    outputter.scalar_result(calculation=&#39;correct correlation&#39;, result=x_y_correl, currency=False)
    outputter.scalar_result(calculation=&#39;sample_correlation(x, y)&#39;,  result=correl, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#39;correct regression slope&#39;, result=x_y_beta, currency=False)
    outputter.scalar_result(calculation=&#39;simple_regression_beta(x,y)&#39;,  result=beta, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#39;correct regression intercept&#39;,  result=x_y_alpha, currency=False)
    outputter.scalar_result(calculation=&#39;simple_regression_alpha(x,y)&#39;,  result=alpha, currency=False)
    outputter.print_line()

def rolling_recursion_test():
    length = len(rolling_x_y_1[0])
    
    # ACTUAL MEANS
    x_mean_1 = estimators.sample_mean(x=rolling_x_y_1[0])
    x_mean_2 = estimators.sample_mean(x=rolling_x_y_2[0])
    x_mean_3 = estimators.sample_mean(x=rolling_x_y_3[0])
    x_mean_4 = estimators.sample_mean(x=rolling_x_y_4[0])
    y_mean_1 = estimators.sample_mean(x=rolling_x_y_1[1])
    y_mean_2 = estimators.sample_mean(x=rolling_x_y_2[1])
    y_mean_3 = estimators.sample_mean(x=rolling_x_y_3[1])
    y_mean_4 = estimators.sample_mean(x=rolling_x_y_4[1])

    # RECURSIVE MEANS
    recursive_x_mean_2 = estimators.recursive_rolling_mean(xbar_previous=x_mean_1, new_obs=rolling_x_y_2[0][-1], 
                                                    lost_obs=rolling_x_y_1[0][0], n=length)
    recursive_x_mean_3 = estimators.recursive_rolling_mean(xbar_previous=x_mean_2, new_obs=rolling_x_y_3[0][-1], 
                                                    lost_obs=rolling_x_y_2[0][0], n=length)
    recursive_x_mean_4 = estimators.recursive_rolling_mean(xbar_previous=x_mean_3, new_obs=rolling_x_y_4[0][-1], 
                                                    lost_obs=rolling_x_y_3[0][0], n=length)
    recursive_y_mean_2 = estimators.recursive_rolling_mean(xbar_previous=y_mean_1, new_obs=rolling_x_y_2[1][-1], 
                                                    lost_obs=rolling_x_y_1[1][0], n=length)
    recursive_y_mean_3 = estimators.recursive_rolling_mean(xbar_previous=y_mean_2, new_obs=rolling_x_y_3[1][-1], 
                                                    lost_obs=rolling_x_y_2[1][0], n=length)
    recursive_y_mean_4 = estimators.recursive_rolling_mean(xbar_previous=y_mean_3, new_obs=rolling_x_y_4[1][-1], 
                                                    lost_obs=rolling_x_y_3[1][0], n=length)

    # ACTUAL VARIANCES
    var_1 = estimators.sample_variance(x=rolling_x_y_1[0])
    var_2 = estimators.sample_variance(x=rolling_x_y_2[0])
    var_3 = estimators.sample_variance(x=rolling_x_y_3[0])
    var_4 = estimators.sample_variance(x=rolling_x_y_4[0])

    # RECURSIVE VARIANCES
    recursive_var_2 = estimators.recursive_rolling_variance(var_previous=var_1, xbar_previous=x_mean_1, new_obs=rolling_x_y_2[0][-1], 
                                                    lost_obs=rolling_x_y_1[0][0], n=length)
    recursive_var_3 = estimators.recursive_rolling_variance(var_previous=var_2, xbar_previous=recursive_x_mean_2, new_obs=rolling_x_y_3[0][-1], 
                                                    lost_obs=rolling_x_y_2[0][0], n=length)
    recursive_var_4 = estimators.recursive_rolling_variance(var_previous=var_3, xbar_previous=recursive_x_mean_3, new_obs=rolling_x_y_4[0][-1], 
                                                    lost_obs=rolling_x_y_3[0][0], n=length)

    # ACTUAL COVARIANCES
    covar_1 = estimators.sample_covariance(x=rolling_x_y_1[0], y=rolling_x_y_1[1])
    covar_2 = estimators.sample_covariance(x=rolling_x_y_2[0], y=rolling_x_y_2[1])
    covar_3 = estimators.sample_covariance(x=rolling_x_y_3[0], y=rolling_x_y_3[1])
    covar_4 = estimators.sample_covariance(x=rolling_x_y_4[0], y=rolling_x_y_4[1])

    # RECURSIVE COVARIANCES
    recursive_covar_2 = estimators.recursive_rolling_covariance(covar_previous=covar_1, new_x_obs=rolling_x_y_2[0][-1], 
                                                        lost_x_obs=rolling_x_y_1[0][0], previous_x_bar= x_mean_1,
                                                        new_y_obs=rolling_x_y_2[1][-1], lost_y_obs=rolling_x_y_1[1][0], 
                                                        previous_y_bar=y_mean_1, n=length)
    recursive_covar_3 = estimators.recursive_rolling_covariance(covar_previous=covar_2, new_x_obs=rolling_x_y_3[0][-1], 
                                                        lost_x_obs=rolling_x_y_2[0][0], previous_x_bar = x_mean_2,
                                                        new_y_obs=rolling_x_y_3[1][-1], lost_y_obs=rolling_x_y_2[1][0],
                                                        previous_y_bar = y_mean_2, n=length)
    recursive_covar_4 = estimators.recursive_rolling_covariance(covar_previous=covar_3, new_x_obs=rolling_x_y_4[0][-1], 
                                                        lost_x_obs=rolling_x_y_3[0][0], previous_x_bar=x_mean_3, 
                                                        new_y_obs=rolling_x_y_4[1][-1], lost_y_obs=rolling_x_y_3[1][0], 
                                                        previous_y_bar=y_mean_3, n=length)

    # TEST RESULTS
    outputter.scalar_result(calculation=&#34;Actual Mean 2&#34;, result=x_mean_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Mean 2&#34;, result=recursive_x_mean_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Y Mean 2&#34;, result=y_mean_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Y Mean 2&#34;, result=recursive_y_mean_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Variance 2&#34;, result=var_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Variance 2&#34;, result=recursive_var_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Covariance 2&#34;, result=covar_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Covariance 2&#34;, result=recursive_covar_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Mean 3&#34;, result=x_mean_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Mean 3&#34;, result=recursive_x_mean_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Y Mean 3&#34;, result=y_mean_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Y Mean 3&#34;, result=recursive_y_mean_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Variance 3&#34;, result=var_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Variance 3&#34;, result=recursive_var_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Covariance 3&#34;, result=covar_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Covariance 3&#34;, result=recursive_covar_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Mean 4&#34;, result=x_mean_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Mean 4&#34;, result=recursive_x_mean_4, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Y Mean 4&#34;, result=y_mean_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Y Mean 4&#34;, result=recursive_y_mean_4, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Variance 4&#34;, result=var_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Variance 4&#34;, result=recursive_var_4, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Covariance 4&#34;, result=covar_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Covariance 4&#34;, result=recursive_covar_4, currency=False)
    outputter.print_line()

def rolling_recursion_tests_with_financial_data():
    trading_period = static.get_trading_period(asset_type=static.keys[&#39;ASSETS&#39;][&#39;EQUITY&#39;])

    for ticker in test_tickers:
        for date in test_dates:
            start_date = helper.decrement_date_string_by_business_days(start_date_string=date, 
                                                                business_days=settings.DEFAULT_ANALYSIS_PERIOD)
            previous_end_date = helper.decrement_date_string_by_business_days(start_date_string=date, 
                                                                        business_days=1)
            previous_start_date = helper.decrement_date_string_by_business_days(start_date_string=start_date, 
                                                                            business_days=1)
            
            prices = services.get_daily_price_history(ticker=ticker, 
                                                        start_date=dater.parse_date_string(previous_start_date), 
                                                        end_date=dater.parse_date_string(date), 
                                                        asset_type=static.keys[&#39;ASSETS&#39;][&#39;EQUITY&#39;])
            previous_prices = dict(prices)
            new_prices = dict(prices)
            del previous_prices[date]
            del new_prices[previous_start_date]
            
            end_date_price = prices[date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]
            previous_end_date_price = prices[previous_end_date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]
            start_date_price = prices[start_date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]
            previous_start_date_price = prices[start_date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]

            new_return = numpy.log(float(end_date_price)/float(previous_end_date_price))/trading_period
            lost_return = numpy.log(float(start_date_price)/float(previous_start_date_price))/trading_period
            new_mod_return = new_return*numpy.sqrt(trading_period)
            lost_mod_return = lost_return*numpy.sqrt(trading_period)

            old_profile = statistics.calculate_moment_risk_return(ticker=ticker, sample_prices=previous_prices)
            old_var = old_profile[&#39;annual_volatility&#39;]**2
            old_mod_return = old_profile[&#39;annual_return&#39;]*numpy.sqrt(trading_period)

            new_actual_profile = statistics.calculate_moment_risk_return(ticker=ticker, sample_prices=new_prices)

            new_recursive_profile = {}
            new_recursive_profile[&#39;annual_return&#39;] = estimators.recursive_rolling_mean(xbar_previous=old_profile[&#39;annual_return&#39;],
                                                                                new_obs=new_return,
                                                                                lost_obs=lost_return)
            new_recursive_profile[&#39;annual_volatility&#39;] = estimators.recursive_rolling_variance(var_previous=old_var,
                                                                                        xbar_previous=old_mod_return,
                                                                                        new_obs=new_mod_return,
                                                                                        lost_obs=lost_mod_return)
            new_recursive_profile[&#39;annual_volatility&#39;] = numpy.sqrt(new_recursive_profile[&#39;annual_volatility&#39;])
            # ito&#39;s lemma
            # new_recursive_profile[&#39;annual_return&#39;] = new_recursive_profile[&#39;annual_return&#39;] - 0.5 * (new_recursive_profile[&#39;annual_volatility&#39;] ** 2)

            outputter.scalar_result(calculation=f&#39;{ticker}_return({date})_actual&#39;, result=new_actual_profile[&#39;annual_return&#39;],currency=False)
            outputter.scalar_result(calculation=f&#39;{ticker}_return({date})_recursive&#39;, result=new_recursive_profile[&#39;annual_return&#39;], currency=False)
            outputter.scalar_result(calculation=f&#39;{ticker}_vol({date})_actual&#39;, result=new_actual_profile[&#39;annual_volatility&#39;], currency=False)
            outputter.scalar_result(calculation=f&#39;{ticker}_vol({date})_recursive&#39;, result=new_recursive_profile[&#39;annual_volatility&#39;], currency=False)

# TODO: need to test service retrieval through command line to be confident it&#39;s returning the correct info.

if __name__ == &#34;__main__&#34;:
    outputter.print_line()
    outputter.center(&#39;Percentile Testing&#39;)
    percentile_test()

    outputter.print_line()
    outputter.center(&#34;Regression Testing&#34;)
    outputter.print_line()
    outputter.title_line(&#39;Test Results&#39;)
    outputter.print_line()
    simple_regression_test()

    outputter.print_line()
    outputter.center(&#34;Rolling Sample Statistics Recursion Testing&#34;)
    outputter.print_line()
    outputter.title_line(&#39;Test Results&#39;)
    outputter.print_line()
    rolling_recursion_test()

    # outputter.print_line()
    # outputter.center(&#39;Rolling Recursive Risk Profile Test&#39;)
    # outputter.print_line()
    # outputter.title_line(&#39;Test Results&#39;)
    # outputter.print_line()
    # rolling_recursion_tests_with_financial_data()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="scrilla.tests.estimator_tests.percentile_test"><code class="name flex">
<span>def <span class="ident">percentile_test</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def percentile_test():
    print(&#39;data : &#39;,x_y_data[1])
    twenty_fifth = estimators.sample_percentile(data=x_y_data[1], percentile=0.25)
    fiftieth = estimators.sample_percentile(data=x_y_data[1], percentile=0.5)
    seventy_fifth = estimators.sample_percentile(data=x_y_data[1], percentile=0.75)
    ninetieth = estimators.sample_percentile(data=x_y_data[1], percentile=0.90)

    outputter.print_line()
    outputter.scalar_result(calculation=&#39;25th percentile&#39;, result = twenty_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;50th percentile&#39;, result = fiftieth, currency=False)
    outputter.scalar_result(calculation=&#39;75th percentile&#39;, result = seventy_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;90th percentile&#39;, result = ninetieth, currency=False)
    outputter.print_line()

    print(&#39;data : &#39;, lots)
    twenty_fifth = estimators.sample_percentile(data=lots, percentile=0.25)
    fiftieth = estimators.sample_percentile(data=lots, percentile=0.5)
    seventy_fifth = estimators.sample_percentile(data=lots, percentile=0.75)
    ninetieth = estimators.sample_percentile(data=lots, percentile=0.90)

    outputter.print_line()
    outputter.scalar_result(calculation=&#39;25th percentile&#39;, result = twenty_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;50th percentile&#39;, result = fiftieth, currency=False)
    outputter.scalar_result(calculation=&#39;75th percentile&#39;, result = seventy_fifth, currency=False)
    outputter.scalar_result(calculation=&#39;90th percentile&#39;, result = ninetieth, currency=False)
    outputter.print_line()</code></pre>
</details>
</dd>
<dt id="scrilla.tests.estimator_tests.rolling_recursion_test"><code class="name flex">
<span>def <span class="ident">rolling_recursion_test</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rolling_recursion_test():
    length = len(rolling_x_y_1[0])
    
    # ACTUAL MEANS
    x_mean_1 = estimators.sample_mean(x=rolling_x_y_1[0])
    x_mean_2 = estimators.sample_mean(x=rolling_x_y_2[0])
    x_mean_3 = estimators.sample_mean(x=rolling_x_y_3[0])
    x_mean_4 = estimators.sample_mean(x=rolling_x_y_4[0])
    y_mean_1 = estimators.sample_mean(x=rolling_x_y_1[1])
    y_mean_2 = estimators.sample_mean(x=rolling_x_y_2[1])
    y_mean_3 = estimators.sample_mean(x=rolling_x_y_3[1])
    y_mean_4 = estimators.sample_mean(x=rolling_x_y_4[1])

    # RECURSIVE MEANS
    recursive_x_mean_2 = estimators.recursive_rolling_mean(xbar_previous=x_mean_1, new_obs=rolling_x_y_2[0][-1], 
                                                    lost_obs=rolling_x_y_1[0][0], n=length)
    recursive_x_mean_3 = estimators.recursive_rolling_mean(xbar_previous=x_mean_2, new_obs=rolling_x_y_3[0][-1], 
                                                    lost_obs=rolling_x_y_2[0][0], n=length)
    recursive_x_mean_4 = estimators.recursive_rolling_mean(xbar_previous=x_mean_3, new_obs=rolling_x_y_4[0][-1], 
                                                    lost_obs=rolling_x_y_3[0][0], n=length)
    recursive_y_mean_2 = estimators.recursive_rolling_mean(xbar_previous=y_mean_1, new_obs=rolling_x_y_2[1][-1], 
                                                    lost_obs=rolling_x_y_1[1][0], n=length)
    recursive_y_mean_3 = estimators.recursive_rolling_mean(xbar_previous=y_mean_2, new_obs=rolling_x_y_3[1][-1], 
                                                    lost_obs=rolling_x_y_2[1][0], n=length)
    recursive_y_mean_4 = estimators.recursive_rolling_mean(xbar_previous=y_mean_3, new_obs=rolling_x_y_4[1][-1], 
                                                    lost_obs=rolling_x_y_3[1][0], n=length)

    # ACTUAL VARIANCES
    var_1 = estimators.sample_variance(x=rolling_x_y_1[0])
    var_2 = estimators.sample_variance(x=rolling_x_y_2[0])
    var_3 = estimators.sample_variance(x=rolling_x_y_3[0])
    var_4 = estimators.sample_variance(x=rolling_x_y_4[0])

    # RECURSIVE VARIANCES
    recursive_var_2 = estimators.recursive_rolling_variance(var_previous=var_1, xbar_previous=x_mean_1, new_obs=rolling_x_y_2[0][-1], 
                                                    lost_obs=rolling_x_y_1[0][0], n=length)
    recursive_var_3 = estimators.recursive_rolling_variance(var_previous=var_2, xbar_previous=recursive_x_mean_2, new_obs=rolling_x_y_3[0][-1], 
                                                    lost_obs=rolling_x_y_2[0][0], n=length)
    recursive_var_4 = estimators.recursive_rolling_variance(var_previous=var_3, xbar_previous=recursive_x_mean_3, new_obs=rolling_x_y_4[0][-1], 
                                                    lost_obs=rolling_x_y_3[0][0], n=length)

    # ACTUAL COVARIANCES
    covar_1 = estimators.sample_covariance(x=rolling_x_y_1[0], y=rolling_x_y_1[1])
    covar_2 = estimators.sample_covariance(x=rolling_x_y_2[0], y=rolling_x_y_2[1])
    covar_3 = estimators.sample_covariance(x=rolling_x_y_3[0], y=rolling_x_y_3[1])
    covar_4 = estimators.sample_covariance(x=rolling_x_y_4[0], y=rolling_x_y_4[1])

    # RECURSIVE COVARIANCES
    recursive_covar_2 = estimators.recursive_rolling_covariance(covar_previous=covar_1, new_x_obs=rolling_x_y_2[0][-1], 
                                                        lost_x_obs=rolling_x_y_1[0][0], previous_x_bar= x_mean_1,
                                                        new_y_obs=rolling_x_y_2[1][-1], lost_y_obs=rolling_x_y_1[1][0], 
                                                        previous_y_bar=y_mean_1, n=length)
    recursive_covar_3 = estimators.recursive_rolling_covariance(covar_previous=covar_2, new_x_obs=rolling_x_y_3[0][-1], 
                                                        lost_x_obs=rolling_x_y_2[0][0], previous_x_bar = x_mean_2,
                                                        new_y_obs=rolling_x_y_3[1][-1], lost_y_obs=rolling_x_y_2[1][0],
                                                        previous_y_bar = y_mean_2, n=length)
    recursive_covar_4 = estimators.recursive_rolling_covariance(covar_previous=covar_3, new_x_obs=rolling_x_y_4[0][-1], 
                                                        lost_x_obs=rolling_x_y_3[0][0], previous_x_bar=x_mean_3, 
                                                        new_y_obs=rolling_x_y_4[1][-1], lost_y_obs=rolling_x_y_3[1][0], 
                                                        previous_y_bar=y_mean_3, n=length)

    # TEST RESULTS
    outputter.scalar_result(calculation=&#34;Actual Mean 2&#34;, result=x_mean_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Mean 2&#34;, result=recursive_x_mean_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Y Mean 2&#34;, result=y_mean_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Y Mean 2&#34;, result=recursive_y_mean_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Variance 2&#34;, result=var_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Variance 2&#34;, result=recursive_var_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Covariance 2&#34;, result=covar_2, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Covariance 2&#34;, result=recursive_covar_2, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Mean 3&#34;, result=x_mean_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Mean 3&#34;, result=recursive_x_mean_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Y Mean 3&#34;, result=y_mean_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Y Mean 3&#34;, result=recursive_y_mean_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Variance 3&#34;, result=var_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Variance 3&#34;, result=recursive_var_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Covariance 3&#34;, result=covar_3, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Covariance 3&#34;, result=recursive_covar_3, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Mean 4&#34;, result=x_mean_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Mean 4&#34;, result=recursive_x_mean_4, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Y Mean 4&#34;, result=y_mean_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Y Mean 4&#34;, result=recursive_y_mean_4, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Variance 4&#34;, result=var_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Variance 4&#34;, result=recursive_var_4, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#34;Actual Covariance 4&#34;, result=covar_4, currency=False)
    outputter.scalar_result(calculation=&#34;Recursive Covariance 4&#34;, result=recursive_covar_4, currency=False)
    outputter.print_line()</code></pre>
</details>
</dd>
<dt id="scrilla.tests.estimator_tests.rolling_recursion_tests_with_financial_data"><code class="name flex">
<span>def <span class="ident">rolling_recursion_tests_with_financial_data</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def rolling_recursion_tests_with_financial_data():
    trading_period = static.get_trading_period(asset_type=static.keys[&#39;ASSETS&#39;][&#39;EQUITY&#39;])

    for ticker in test_tickers:
        for date in test_dates:
            start_date = helper.decrement_date_string_by_business_days(start_date_string=date, 
                                                                business_days=settings.DEFAULT_ANALYSIS_PERIOD)
            previous_end_date = helper.decrement_date_string_by_business_days(start_date_string=date, 
                                                                        business_days=1)
            previous_start_date = helper.decrement_date_string_by_business_days(start_date_string=start_date, 
                                                                            business_days=1)
            
            prices = services.get_daily_price_history(ticker=ticker, 
                                                        start_date=dater.parse_date_string(previous_start_date), 
                                                        end_date=dater.parse_date_string(date), 
                                                        asset_type=static.keys[&#39;ASSETS&#39;][&#39;EQUITY&#39;])
            previous_prices = dict(prices)
            new_prices = dict(prices)
            del previous_prices[date]
            del new_prices[previous_start_date]
            
            end_date_price = prices[date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]
            previous_end_date_price = prices[previous_end_date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]
            start_date_price = prices[start_date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]
            previous_start_date_price = prices[start_date][static.keys[&#39;PRICES&#39;][&#39;CLOSE&#39;]]

            new_return = numpy.log(float(end_date_price)/float(previous_end_date_price))/trading_period
            lost_return = numpy.log(float(start_date_price)/float(previous_start_date_price))/trading_period
            new_mod_return = new_return*numpy.sqrt(trading_period)
            lost_mod_return = lost_return*numpy.sqrt(trading_period)

            old_profile = statistics.calculate_moment_risk_return(ticker=ticker, sample_prices=previous_prices)
            old_var = old_profile[&#39;annual_volatility&#39;]**2
            old_mod_return = old_profile[&#39;annual_return&#39;]*numpy.sqrt(trading_period)

            new_actual_profile = statistics.calculate_moment_risk_return(ticker=ticker, sample_prices=new_prices)

            new_recursive_profile = {}
            new_recursive_profile[&#39;annual_return&#39;] = estimators.recursive_rolling_mean(xbar_previous=old_profile[&#39;annual_return&#39;],
                                                                                new_obs=new_return,
                                                                                lost_obs=lost_return)
            new_recursive_profile[&#39;annual_volatility&#39;] = estimators.recursive_rolling_variance(var_previous=old_var,
                                                                                        xbar_previous=old_mod_return,
                                                                                        new_obs=new_mod_return,
                                                                                        lost_obs=lost_mod_return)
            new_recursive_profile[&#39;annual_volatility&#39;] = numpy.sqrt(new_recursive_profile[&#39;annual_volatility&#39;])
            # ito&#39;s lemma
            # new_recursive_profile[&#39;annual_return&#39;] = new_recursive_profile[&#39;annual_return&#39;] - 0.5 * (new_recursive_profile[&#39;annual_volatility&#39;] ** 2)

            outputter.scalar_result(calculation=f&#39;{ticker}_return({date})_actual&#39;, result=new_actual_profile[&#39;annual_return&#39;],currency=False)
            outputter.scalar_result(calculation=f&#39;{ticker}_return({date})_recursive&#39;, result=new_recursive_profile[&#39;annual_return&#39;], currency=False)
            outputter.scalar_result(calculation=f&#39;{ticker}_vol({date})_actual&#39;, result=new_actual_profile[&#39;annual_volatility&#39;], currency=False)
            outputter.scalar_result(calculation=f&#39;{ticker}_vol({date})_recursive&#39;, result=new_recursive_profile[&#39;annual_volatility&#39;], currency=False)</code></pre>
</details>
</dd>
<dt id="scrilla.tests.estimator_tests.simple_regression_test"><code class="name flex">
<span>def <span class="ident">simple_regression_test</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def simple_regression_test():
    # REGRESSION CALCULATIONS
    correl = estimators.sample_correlation(x=x_y_data[0], y=x_y_data[1])
    beta = estimators.simple_regression_beta(x=x_y_data[0],y=x_y_data[1])
    alpha = estimators.simple_regression_alpha(x=x_y_data[0],y=x_y_data[1])
    
    # TEST RESULTS
    outputter.scalar_result(calculation=&#39;correct correlation&#39;, result=x_y_correl, currency=False)
    outputter.scalar_result(calculation=&#39;sample_correlation(x, y)&#39;,  result=correl, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#39;correct regression slope&#39;, result=x_y_beta, currency=False)
    outputter.scalar_result(calculation=&#39;simple_regression_beta(x,y)&#39;,  result=beta, currency=False)
    outputter.print_line()
    outputter.scalar_result(calculation=&#39;correct regression intercept&#39;,  result=x_y_alpha, currency=False)
    outputter.scalar_result(calculation=&#39;simple_regression_alpha(x,y)&#39;,  result=alpha, currency=False)
    outputter.print_line()</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="scrilla.tests" href="index.html">scrilla.tests</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="scrilla.tests.estimator_tests.percentile_test" href="#scrilla.tests.estimator_tests.percentile_test">percentile_test</a></code></li>
<li><code><a title="scrilla.tests.estimator_tests.rolling_recursion_test" href="#scrilla.tests.estimator_tests.rolling_recursion_test">rolling_recursion_test</a></code></li>
<li><code><a title="scrilla.tests.estimator_tests.rolling_recursion_tests_with_financial_data" href="#scrilla.tests.estimator_tests.rolling_recursion_tests_with_financial_data">rolling_recursion_tests_with_financial_data</a></code></li>
<li><code><a title="scrilla.tests.estimator_tests.simple_regression_test" href="#scrilla.tests.estimator_tests.simple_regression_test">simple_regression_test</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>