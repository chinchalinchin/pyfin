<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>scrilla.analysis.models.geometric.probability API documentation</title>
<meta name="description" content="This module contains probability functions unique to the Geometric Brownian Motion stochastic model. All functions assume an asset price process that â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>scrilla.analysis.models.geometric.probability</code></h1>
</header>
<section id="section-intro">
<p>This module contains probability functions unique to the Geometric Brownian Motion stochastic model. All functions assume an asset price process that follows GBM. In other words, the return distribution is lognormal. This is equivalent to the Black-Scholes model from finance. </p>
<p>The calculations have no stance on whether the actual probability distribution or the risk-neutral probability distribution should be used. This is implicitly specified by the user when they provided a rate of return to functions in this module. If the user wishes to use a risk-neutral probability, simply provide the assumed risk-free rate. If the user wishes to use an actual probability, provide the estimate of the rate of the return for the asset.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># This file is part of scrilla: https://github.com/chinchalinchin/scrilla.

# scrilla is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 3
# as published by the Free Software Foundation.

# scrilla is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with scrilla.  If not, see &lt;https://www.gnu.org/licenses/&gt;
# or &lt;https://github.com/chinchalinchin/scrilla/blob/develop/main/LICENSE&gt;.
&#34;&#34;&#34;
This module contains probability functions unique to the Geometric Brownian Motion stochastic model. All functions assume an asset price process that follows GBM. In other words, the return distribution is lognormal. This is equivalent to the Black-Scholes model from finance. 

The calculations have no stance on whether the actual probability distribution or the risk-neutral probability distribution should be used. This is implicitly specified by the user when they provided a rate of return to functions in this module. If the user wishes to use a risk-neutral probability, simply provide the assumed risk-free rate. If the user wishes to use an actual probability, provide the estimate of the rate of the return for the asset.
&#34;&#34;&#34;
from scipy.stats import norm
from math import sqrt, exp, log
from scrilla import settings
from scrilla.util.outputter import Logger

logger = Logger(&#39;scrilla.analysis.models.geometric.statistics&#39;,
                settings.LOG_LEVEL)


def d1(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Returns the value of *d1* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float`
        Initial value of the asset.
    2. **ST** : ``float``
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.

    Returns
    -------
    ``float`` : Black-Scholes *d1*
    &#34;&#34;&#34;
    numerator = log(S0/ST) + (ret - div + 0.5 * (vol ** 2))*expiry
    denominator = vol * sqrt(expiry)
    return (numerator/denominator)


def d2(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Returns the value of *d2* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **ST** : ``float``
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.

    Returns
    -------
    ``float`` : Black-Scholes *d2*
    &#34;&#34;&#34;
    thisD1 = d1(S0=S0, ST=ST, vol=vol, ret=ret, expiry=expiry, div=div)
    adjust = vol * sqrt(expiry)
    return (thisD1 - adjust)


def prob_d1(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0, neg: bool = False) -&gt; float:
    &#34;&#34;&#34;
    Returns the probability of *d1* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **ST** : ``float`
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.  
    7. **neg**: ``bool``
        *Optional*. Calculates the probability of *-d1*. Defaults to `False`.

    Returns
    -------
    ``float`` : cumulative probability of *d1*
    &#34;&#34;&#34;
    thisD1 = d1(S0=S0, ST=ST, vol=vol, ret=ret, expiry=expiry, div=div)
    if neg:
        thisD1 = -thisD1
    return norm.cdf(thisD1)


def prob_d2(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0, neg: bool = False):
    &#34;&#34;&#34;
    Returns the probability of *d2* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **ST** : ``float`
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0`. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.  
    7. **neg**: ``bool``
        *Optional*. Calculates the probability of *-d2*. Defaults to `False`.

    Returns
    -------
    ``float`` : cumulative probability of *d2*
    &#34;&#34;&#34;
    thisD2 = d2(S0=S0, ST=ST, vol=vol, ret=ret, expiry=expiry, div=div)
    if neg:
        thisD2 = -thisD2
    return norm.cdf(thisD2)


def percentile(S0: float, vol: float, ret: float, expiry: float, prob: float, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Returns the final value of the asset price over the time horizon `expiry` that corresponds the `percentile` of the price&#39;s distribution. The asset price process is assumed to follow Geometric Brownian Motion, i.e. the return distribution is lognormal. 

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **vol**: ``float``
        Annualized volatility of the asset price process.
    3. **ret**: ``float``
        Annualized return of the asset price process.
    4. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    5. **prob**: ``float``
        Percentile of the distribution to be returned, i.e. if S is the price process and \\(S_t\\) is the percentile,
        
        $$ Pr(S&lt;S_t)=prob $$
        
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0. 

    Returns
    -------
    ``float`` : percentile of lognormal distribution

    .. notes::
        * Percentiles are preserved under log transformations, so the asset percentile is equal to the exponentiated return percentile. See Wiki article for more information: https://en.wikipedia.org/wiki/Log-normal_distribution#Mode,_median,_quantiles
    &#34;&#34;&#34;
    inv_norm = norm.ppf(prob)
    exponent = (ret - div - 0.5*(vol**2))*expiry + vol*sqrt(expiry)*inv_norm
    return (S0*exp(exponent))


def conditional_expected_value(S0: float, vol: float, ret: float, expiry: float, conditional_value: float,  greater: bool = False, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Calculates the conditional expected value of an equity, assuming the price process follows Geometric Brownian Motion, i.e. the price distribution is lognormal.

    Note: Returns either
        &gt;&gt;&gt; if greater:
            &gt;&gt;&gt; E( St | St &gt; condtional_value)
        &gt;&gt;&gt; if not greater:
            &gt;&gt;&gt; E( St | St &lt; conditional_value)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial equity price.
    2. **vol** : ``float``
        Annualized volatility.
    3. ***ret**: ``float``
        Annualized return.
    4. **expiry** : ``float``
        Time in years until the condition is evaluated.
    5. **conditional_value**: ``float``
        The value of the equity conditioned on at time ``expiry``.
    6. **greater** : ``boolean``
        *Optional*. Defaults to `False`. Determines the direction of the inequality for the condition attached to the expectation. See function description for more information.
    7. **div**: ``float``
        *Optional*. Defaults to `0`. Annualized dividend yield.
    &#34;&#34;&#34;
    forward_value = S0*exp((ret - div)*expiry)
    if greater:
        this_prob_d1 = prob_d1(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div)
        this_prob_d2 = prob_d2(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div)
    else:
        this_prob_d1 = prob_d1(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div, neg=True)
        this_prob_d2 = prob_d2(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div, neg=True)

    return (forward_value*this_prob_d1/this_prob_d2)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="scrilla.analysis.models.geometric.probability.conditional_expected_value"><code class="name flex">
<span>def <span class="ident">conditional_expected_value</span></span>(<span>S0:Â float, vol:Â float, ret:Â float, expiry:Â float, conditional_value:Â float, greater:Â boolÂ =Â False, div:Â floatÂ =Â 0) â€‘>Â float</span>
</code></dt>
<dd>
<div class="desc"><p>Calculates the conditional expected value of an equity, assuming the price process follows Geometric Brownian Motion, i.e. the price distribution is lognormal.</p>
<p>Note: Returns either
&gt;&gt;&gt; if greater:
&gt;&gt;&gt; E( St | St &gt; condtional_value)
&gt;&gt;&gt; if not greater:
&gt;&gt;&gt; E( St | St &lt; conditional_value)</p>
<h2 id="parameters">Parameters</h2>
<ol>
<li><strong>S0</strong> : <code>float</code>
Initial equity price.</li>
<li><strong>vol</strong> : <code>float</code>
Annualized volatility.</li>
<li><strong>*ret</strong>: <code>float</code>
Annualized return.</li>
<li><strong>expiry</strong> : <code>float</code>
Time in years until the condition is evaluated.</li>
<li><strong>conditional_value</strong>: <code>float</code>
The value of the equity conditioned on at time <code>expiry</code>.</li>
<li><strong>greater</strong> : <code>boolean</code>
<em>Optional</em>. Defaults to <code>False</code>. Determines the direction of the inequality for the condition attached to the expectation. See function description for more information.</li>
<li><strong>div</strong>: <code>float</code>
<em>Optional</em>. Defaults to <code>0</code>. Annualized dividend yield.</li>
</ol></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def conditional_expected_value(S0: float, vol: float, ret: float, expiry: float, conditional_value: float,  greater: bool = False, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Calculates the conditional expected value of an equity, assuming the price process follows Geometric Brownian Motion, i.e. the price distribution is lognormal.

    Note: Returns either
        &gt;&gt;&gt; if greater:
            &gt;&gt;&gt; E( St | St &gt; condtional_value)
        &gt;&gt;&gt; if not greater:
            &gt;&gt;&gt; E( St | St &lt; conditional_value)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial equity price.
    2. **vol** : ``float``
        Annualized volatility.
    3. ***ret**: ``float``
        Annualized return.
    4. **expiry** : ``float``
        Time in years until the condition is evaluated.
    5. **conditional_value**: ``float``
        The value of the equity conditioned on at time ``expiry``.
    6. **greater** : ``boolean``
        *Optional*. Defaults to `False`. Determines the direction of the inequality for the condition attached to the expectation. See function description for more information.
    7. **div**: ``float``
        *Optional*. Defaults to `0`. Annualized dividend yield.
    &#34;&#34;&#34;
    forward_value = S0*exp((ret - div)*expiry)
    if greater:
        this_prob_d1 = prob_d1(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div)
        this_prob_d2 = prob_d2(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div)
    else:
        this_prob_d1 = prob_d1(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div, neg=True)
        this_prob_d2 = prob_d2(S0=S0, ST=conditional_value,
                               vol=vol, ret=ret, expiry=expiry, div=div, neg=True)

    return (forward_value*this_prob_d1/this_prob_d2)</code></pre>
</details>
</dd>
<dt id="scrilla.analysis.models.geometric.probability.d1"><code class="name flex">
<span>def <span class="ident">d1</span></span>(<span>S0:Â float, ST:Â float, vol:Â float, ret:Â float, expiry:Â float, div:Â floatÂ =Â 0) â€‘>Â float</span>
</code></dt>
<dd>
<div class="desc"><p>Returns the value of <em>d1</em> defined by the Black Scholes model (Geometric Brownian Motion)</p>
<h2 id="parameters">Parameters</h2>
<ol>
<li><strong>S0</strong> : <code>`float</code>
Initial value of the asset.</li>
<li><strong>ST</strong> : <code>float</code>
Final value of the asset.</li>
<li><strong>vol</strong>: <code>float</code>
Annualized volatility of the asset price process.</li>
<li><strong>ret</strong>: <code>float</code>
Annualized return of the asset price process.</li>
<li><strong>expiry</strong>: <code>float</code>
Time horizon in years, i.e. the time delta between <code>ST</code> and <code>S0</code> measured in years. </li>
<li><strong>div</strong>: <code>float</code>
<em>Optional</em>. Annualized dividend yield. Defaults to 0.</li>
</ol>
<h2 id="returns">Returns</h2>
<p><code>float</code> : Black-Scholes <em>d1</em></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def d1(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Returns the value of *d1* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float`
        Initial value of the asset.
    2. **ST** : ``float``
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.

    Returns
    -------
    ``float`` : Black-Scholes *d1*
    &#34;&#34;&#34;
    numerator = log(S0/ST) + (ret - div + 0.5 * (vol ** 2))*expiry
    denominator = vol * sqrt(expiry)
    return (numerator/denominator)</code></pre>
</details>
</dd>
<dt id="scrilla.analysis.models.geometric.probability.d2"><code class="name flex">
<span>def <span class="ident">d2</span></span>(<span>S0:Â float, ST:Â float, vol:Â float, ret:Â float, expiry:Â float, div:Â floatÂ =Â 0) â€‘>Â float</span>
</code></dt>
<dd>
<div class="desc"><p>Returns the value of <em>d2</em> defined by the Black Scholes model (Geometric Brownian Motion)</p>
<h2 id="parameters">Parameters</h2>
<ol>
<li><strong>S0</strong> : <code>float</code>
Initial value of the asset.</li>
<li><strong>ST</strong> : <code>float</code>
Final value of the asset.</li>
<li><strong>vol</strong>: <code>float</code>
Annualized volatility of the asset price process.</li>
<li><strong>ret</strong>: <code>float</code>
Annualized return of the asset price process.</li>
<li><strong>expiry</strong>: <code>float</code>
Time horizon in years, i.e. the time delta between <code>ST</code> and <code>S0</code> measured in years. </li>
<li><strong>div</strong>: <code>float</code>
<em>Optional</em>. Annualized dividend yield. Defaults to 0.</li>
</ol>
<h2 id="returns">Returns</h2>
<p><code>float</code> : Black-Scholes <em>d2</em></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def d2(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Returns the value of *d2* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **ST** : ``float``
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.

    Returns
    -------
    ``float`` : Black-Scholes *d2*
    &#34;&#34;&#34;
    thisD1 = d1(S0=S0, ST=ST, vol=vol, ret=ret, expiry=expiry, div=div)
    adjust = vol * sqrt(expiry)
    return (thisD1 - adjust)</code></pre>
</details>
</dd>
<dt id="scrilla.analysis.models.geometric.probability.percentile"><code class="name flex">
<span>def <span class="ident">percentile</span></span>(<span>S0:Â float, vol:Â float, ret:Â float, expiry:Â float, prob:Â float, div:Â floatÂ =Â 0) â€‘>Â float</span>
</code></dt>
<dd>
<div class="desc"><p>Returns the final value of the asset price over the time horizon <code>expiry</code> that corresponds the <code><a title="scrilla.analysis.models.geometric.probability.percentile" href="#scrilla.analysis.models.geometric.probability.percentile">percentile()</a></code> of the price's distribution. The asset price process is assumed to follow Geometric Brownian Motion, i.e. the return distribution is lognormal. </p>
<h2 id="parameters">Parameters</h2>
<ol>
<li><strong>S0</strong> : <code>float</code>
Initial value of the asset.</li>
<li><strong>vol</strong>: <code>float</code>
Annualized volatility of the asset price process.</li>
<li><strong>ret</strong>: <code>float</code>
Annualized return of the asset price process.</li>
<li><strong>expiry</strong>: <code>float</code>
Time horizon in years, i.e. the time delta between <code>ST</code> and <code>S0</code> measured in years. </li>
<li>
<p><strong>prob</strong>: <code>float</code>
Percentile of the distribution to be returned, i.e. if S is the price process and <span><span class="MathJax_Preview">S_t</span><script type="math/tex">S_t</script></span> is the percentile,</p>
<p><span><span class="MathJax_Preview"> Pr(S&lt;S_t)=prob </span><script type="math/tex; mode=display"> Pr(S<S_t)=prob </script></span></p>
</li>
<li>
<p><strong>div</strong>: <code>float</code>
<em>Optional</em>. Annualized dividend yield. Defaults to 0. </p>
</li>
</ol>
<h2 id="returns">Returns</h2>
<p><code>float</code> : percentile of lognormal distribution</p>
<div class="admonition notes">
<p class="admonition-title">Notes</p>
<ul>
<li>Percentiles are preserved under log transformations, so the asset percentile is equal to the exponentiated return percentile. See Wiki article for more information: <a href="https://en.wikipedia.org/wiki/Log-normal_distribution#Mode,_median,_quantiles">https://en.wikipedia.org/wiki/Log-normal_distribution#Mode,_median,_quantiles</a></li>
</ul>
</div></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def percentile(S0: float, vol: float, ret: float, expiry: float, prob: float, div: float = 0) -&gt; float:
    &#34;&#34;&#34;
    Returns the final value of the asset price over the time horizon `expiry` that corresponds the `percentile` of the price&#39;s distribution. The asset price process is assumed to follow Geometric Brownian Motion, i.e. the return distribution is lognormal. 

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **vol**: ``float``
        Annualized volatility of the asset price process.
    3. **ret**: ``float``
        Annualized return of the asset price process.
    4. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    5. **prob**: ``float``
        Percentile of the distribution to be returned, i.e. if S is the price process and \\(S_t\\) is the percentile,
        
        $$ Pr(S&lt;S_t)=prob $$
        
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0. 

    Returns
    -------
    ``float`` : percentile of lognormal distribution

    .. notes::
        * Percentiles are preserved under log transformations, so the asset percentile is equal to the exponentiated return percentile. See Wiki article for more information: https://en.wikipedia.org/wiki/Log-normal_distribution#Mode,_median,_quantiles
    &#34;&#34;&#34;
    inv_norm = norm.ppf(prob)
    exponent = (ret - div - 0.5*(vol**2))*expiry + vol*sqrt(expiry)*inv_norm
    return (S0*exp(exponent))</code></pre>
</details>
</dd>
<dt id="scrilla.analysis.models.geometric.probability.prob_d1"><code class="name flex">
<span>def <span class="ident">prob_d1</span></span>(<span>S0:Â float, ST:Â float, vol:Â float, ret:Â float, expiry:Â float, div:Â floatÂ =Â 0, neg:Â boolÂ =Â False) â€‘>Â float</span>
</code></dt>
<dd>
<div class="desc"><p>Returns the probability of <em>d1</em> defined by the Black Scholes model (Geometric Brownian Motion)</p>
<h2 id="parameters">Parameters</h2>
<ol>
<li><strong>S0</strong> : <code>float</code>
Initial value of the asset.</li>
<li><strong>ST</strong> : <code>`float</code>
Final value of the asset.</li>
<li><strong>vol</strong>: <code>float</code>
Annualized volatility of the asset price process.</li>
<li><strong>ret</strong>: <code>float</code>
Annualized return of the asset price process.</li>
<li><strong>expiry</strong>: <code>float</code>
Time horizon in years, i.e. the time delta between <code>ST</code> and <code>S0</code> measured in years. </li>
<li><strong>div</strong>: <code>float</code>
<em>Optional</em>. Annualized dividend yield. Defaults to 0.
</li>
<li><strong>neg</strong>: <code>bool</code>
<em>Optional</em>. Calculates the probability of <em>-d1</em>. Defaults to <code>False</code>.</li>
</ol>
<h2 id="returns">Returns</h2>
<p><code>float</code> : cumulative probability of <em>d1</em></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def prob_d1(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0, neg: bool = False) -&gt; float:
    &#34;&#34;&#34;
    Returns the probability of *d1* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **ST** : ``float`
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0` measured in years. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.  
    7. **neg**: ``bool``
        *Optional*. Calculates the probability of *-d1*. Defaults to `False`.

    Returns
    -------
    ``float`` : cumulative probability of *d1*
    &#34;&#34;&#34;
    thisD1 = d1(S0=S0, ST=ST, vol=vol, ret=ret, expiry=expiry, div=div)
    if neg:
        thisD1 = -thisD1
    return norm.cdf(thisD1)</code></pre>
</details>
</dd>
<dt id="scrilla.analysis.models.geometric.probability.prob_d2"><code class="name flex">
<span>def <span class="ident">prob_d2</span></span>(<span>S0:Â float, ST:Â float, vol:Â float, ret:Â float, expiry:Â float, div:Â floatÂ =Â 0, neg:Â boolÂ =Â False)</span>
</code></dt>
<dd>
<div class="desc"><p>Returns the probability of <em>d2</em> defined by the Black Scholes model (Geometric Brownian Motion)</p>
<h2 id="parameters">Parameters</h2>
<ol>
<li><strong>S0</strong> : <code>float</code>
Initial value of the asset.</li>
<li><strong>ST</strong> : <code>`float</code>
Final value of the asset.</li>
<li><strong>vol</strong>: <code>float</code>
Annualized volatility of the asset price process.</li>
<li><strong>ret</strong>: <code>float</code>
Annualized return of the asset price process.</li>
<li><strong>expiry</strong>: <code>float</code>
Time horizon in years, i.e. the time delta between <code>ST</code> and <code>S0</code>. </li>
<li><strong>div</strong>: <code>float</code>
<em>Optional</em>. Annualized dividend yield. Defaults to 0.
</li>
<li><strong>neg</strong>: <code>bool</code>
<em>Optional</em>. Calculates the probability of <em>-d2</em>. Defaults to <code>False</code>.</li>
</ol>
<h2 id="returns">Returns</h2>
<p><code>float</code> : cumulative probability of <em>d2</em></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def prob_d2(S0: float, ST: float, vol: float, ret: float, expiry: float, div: float = 0, neg: bool = False):
    &#34;&#34;&#34;
    Returns the probability of *d2* defined by the Black Scholes model (Geometric Brownian Motion)

    Parameters
    ----------
    1. **S0** : ``float``
        Initial value of the asset.
    2. **ST** : ``float`
        Final value of the asset.
    3. **vol**: ``float``
        Annualized volatility of the asset price process.
    4. **ret**: ``float``
        Annualized return of the asset price process.
    5. **expiry**: ``float``
        Time horizon in years, i.e. the time delta between `ST` and `S0`. 
    6. **div**: ``float``
        *Optional*. Annualized dividend yield. Defaults to 0.  
    7. **neg**: ``bool``
        *Optional*. Calculates the probability of *-d2*. Defaults to `False`.

    Returns
    -------
    ``float`` : cumulative probability of *d2*
    &#34;&#34;&#34;
    thisD2 = d2(S0=S0, ST=ST, vol=vol, ret=ret, expiry=expiry, div=div)
    if neg:
        thisD2 = -thisD2
    return norm.cdf(thisD2)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="scrilla.analysis.models.geometric" href="index.html">scrilla.analysis.models.geometric</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="scrilla.analysis.models.geometric.probability.conditional_expected_value" href="#scrilla.analysis.models.geometric.probability.conditional_expected_value">conditional_expected_value</a></code></li>
<li><code><a title="scrilla.analysis.models.geometric.probability.d1" href="#scrilla.analysis.models.geometric.probability.d1">d1</a></code></li>
<li><code><a title="scrilla.analysis.models.geometric.probability.d2" href="#scrilla.analysis.models.geometric.probability.d2">d2</a></code></li>
<li><code><a title="scrilla.analysis.models.geometric.probability.percentile" href="#scrilla.analysis.models.geometric.probability.percentile">percentile</a></code></li>
<li><code><a title="scrilla.analysis.models.geometric.probability.prob_d1" href="#scrilla.analysis.models.geometric.probability.prob_d1">prob_d1</a></code></li>
<li><code><a title="scrilla.analysis.models.geometric.probability.prob_d2" href="#scrilla.analysis.models.geometric.probability.prob_d2">prob_d2</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>